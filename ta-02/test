protected DepositBagContextResponse buildContextResponse(
        CashStockSession session,
        CashStockOperation operation,
        BookingRequestHelper helper) {

    DepositBagContextResponse response = new DepositBagContextResponse();
    response.setCashStockSessionId(String.valueOf(session.getId()));
    response.setCashStockId(String.valueOf(operation.getCashStock().getId()));
    response.setCashStockOperationId(String.valueOf(operation.getId()));
    response.setCashStockOperationStatusName(operation.getStatus());

    BookingResponseHelper responseHelper = new BookingResponseHelper();
    responseHelper.setRemittanceMessage(helper.getRemittanceMessage());
    responseHelper.setForce(helper.getForce());
    responseHelper.setTransactionId(helper.getTransactionId());

    // -------------------------------
    // FIXED DATE PARSING (FLEXIBLE)
    // -------------------------------
    Date transactionDateTime = parseFlexibleDate(helper.getTransactionDateTime());
    responseHelper.setTransactionDateTime(transactionDateTime);

    response.setBookingResponseHelper(responseHelper); // If you have such setter
    return response;
}

private Date parseFlexibleDate(String dateStr) {
    if (dateStr == null || dateStr.isEmpty()) {
        return null;
    }

    // Supported patterns
    String[] patterns = {
            "yyyy-MM-dd-HH.mm.ss.SSSSSS", // your mainframe microseconds
            "yyyy-MM-dd HH:mm:ss",
            "yyyy/MM/dd HH:mm:ss",
            "yyyyMMddHHmmss",
            "dd-MM-yyyy HH:mm:ss",
            "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
            "yyyy-MM-dd'T'HH:mm:ss"
    };

    for (String pattern : patterns) {
        try {
            DateTimeFormatter formatter = DateTimeFormatter.ofPattern(pattern);
            LocalDateTime ldt = LocalDateTime.parse(dateStr, formatter);
            return Date.from(ldt.atZone(ZoneId.systemDefault()).toInstant());
        } catch (Exception ignore) {
            // try next pattern
        }
    }

    throw new RuntimeException("Unsupported date format: " + dateStr);
}








protected DepositBagContextResponse buildContextResponse(CashStockSession session, CashStockOperation operation, BookingRequestHelper helper) {
        DepositBagContextResponse response = new DepositBagContextResponse();
        response.setCashStockSessionId(String.valueOf(session.getId()));
        response.setCashStockId(String.valueOf(operation.getCashStock().getId()));
        response.setCashStockOperationId(String.valueOf(operation.getId()));
        response.setCashStockOperationStatusName(operation.getStatus());
        BookingResponseHelper responseHelper = new BookingResponseHelper();
        responseHelper.setRemittanceMessage(helper.getRemittanceMessage());
        responseHelper.setForce(helper.getForce());
        responseHelper.setTransactionId(helper.getTransactionId());
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        Date transactionDateTime = null;
        try {
            transactionDateTime = dateFormat.parse(helper.getTransactionDateTime());
        } catch (ParseException e) {
            throw new RuntimeException(e);
        }
        responseHelper.setTransactionDateTime(transactionDateTime);
        return response;
    }
